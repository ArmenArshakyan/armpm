<!DOCTYPE html>
<html>
  <head>
    <title>Notes App</title>
  </head>
  <body>
    <h1>Notes App v20</h1>
    <form id="notesForm">
      <textarea id="noteInput" rows="5" cols="50"></textarea>
      <br />
      <button type="submit">Submit</button>
    </form>

    <h2>Notes</h2>
    <div id="notesSection"></div>

    <button id="showNotesButton">Show Notes</button>

    <script>
      document.getElementById('notesForm').addEventListener('submit', async function (event) {
        event.preventDefault();
        const noteInput = document.getElementById('noteInput').value;

        // Send the note to the worker for writing
        const response = await fetch('/write', {
          method: 'POST',
          body: noteInput,
        });

        if (response.ok) {
          // Clear the input field after successful submission
          document.getElementById('noteInput').value = '';

          // Refresh the notes section to display the updated notes
          refreshNotes();
        } else {
          console.error('Failed to write note:', response.status, response.statusText);
        }
      });

      document.getElementById('showNotesButton').addEventListener('click', async function () {
        // Fetch the notes from the worker and display them in the notes section
        const response = await fetch('https://read.armen-arsh.workers.dev/read');

        if (response.ok) {
          const notes = await response.json();

          // Clear the notes section before adding the new notes
          document.getElementById('notesSection').innerHTML = '';

          // Iterate through the notes array and create a paragraph element for each note
          notes.forEach(note => {
            const paragraph = document.createElement('p');
            paragraph.textContent = note;
            document.getElementById('notesSection').appendChild(paragraph);
          });
        } else {
          console.error('Failed to retrieve notes:', response.status, response.statusText);
        }
      });

      // Refresh the notes on page load
      refreshNotes();

      async function refreshNotes() {
        // Fetch the notes from the worker and display them in the notes section
        const response = await fetch('https://read.armen-arsh.workers.dev/read');

        if (response.ok) {
          const notes = await response.json();

          // Clear the notes section before adding the new notes
          document.getElementById('notesSection').innerHTML = '';

          // Iterate through the notes array and create a paragraph element for each note
          notes.forEach(note => {
            const paragraph = document.createElement('p');
            paragraph.textContent = note;
            document.getElementById('notesSection').appendChild(paragraph);
          });
        } else {
          console.error('Failed to retrieve notes:', response.status, response.statusText);
        }
      }
    </script>
  </body>
</html>